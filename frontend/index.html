<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>stuffchat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href="img/favicon.png" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>

<body>
    <canvas id="background-canvas"></canvas>
    <div id="authView" class="glass auth-card">
        <div id="serverStep">
            <div class="brand">stuffchat</div>
            <div class="hint">Enter server address</div>
            <div class="row">
                <input id="cfgBaseUrl" class="input grow" placeholder="Base URL (e.g. http://localhost:8080)" />
                <button id="btnCheckServer" class="button" style="width:auto;">Connect</button>
            </div>
            <div id="serverError" class="error"></div>
        </div>
        <div id="authStep" style="display:none">
            <div class="brand"><i class="bi bi-chat-dots"></i> StuffChat</div>
            <div class="hint" id="serverIdentifier"></div>

            <div class="panel">
                <h3>Login</h3>
                <div class="row">
                    <input id="loginUser" class="input grow" placeholder="Username or email" autocomplete="username" />
                </div>
                <div class="row">
                    <input id="loginPass" class="input grow" type="password" placeholder="Password"
                        autocomplete="current-password" />
                </div>
                <div class="row">
                    <button id="btnLogin" class="button grow">Login</button>
                </div>
                <div id="loginErr" class="error"></div>
            </div>
            <div class="panel" style="margin-top:8px">
                <h3>Register</h3>
                <div class="row"><input id="regUser" class="input grow" placeholder="Username"
                        autocomplete="username" /></div>
                <div class="row"><input id="regEmail" class="input grow" placeholder="Email" autocomplete="email" />
                </div>
                <div class="row"><input id="regPass" class="input grow" type="password"
                        placeholder="Password (min 8 chars)" autocomplete="new-password" /></div>
                <div class="row" id="regInviteRow" style="display:none"><input id="regInvite" class="input grow"
                        placeholder="Invite Code" /></div>
                <div class="row"><button id="btnRegister" class="button grow">Create account</button></div>
                <div id="regErr" class="error"></div>
            </div>
            <div class="row" style="margin-top:12px">
                <button class="button alt grow" onclick="showServerStep()">Back to Server Settings</button>
            </div>
        </div>
    </div>
    <div id="appView" class="app" style="display:none">
        <aside id="sidebar">
            <div class="profile">
                <div class="row center">
                    <div class="avatar" id="meAvatar"></div>
                    <div style="min-width:0; align-items:center; flex:1">
                        <div style="display:flex; align-items:center; gap:6px; flex-wrap:wrap">
                            <div id="meName" style="font-weight:600">—</div>
                            <span id="mePresence" class="presence-dot presence-offline" title="offline"></span>
                        </div>
                        <div id="meEmail" class="hint">—</div>
                    </div>
                    <button id="btnCloseSidebar" class="iconbtn mobile-only" title="Close Sidebar">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <div class="row">
                    <select id="presenceSelect" class="select grow" title="Status">
                        <option value="online">Online</option>
                        <option value="away">Away</option>
                        <option value="dnd">Do Not Disturb</option>
                        <option value="invisible">Invisible</option>
                        <option value="offline">Offline</option>
                    </select>
                    <button id="btnOpenInvites" class="iconbtn" title="Invite codes">
                        <i class="bi bi-people-fill"></i>
                    </button>
                    <button id="btnOpenSettings" class="iconbtn" title="Open settings">
                        <i class="bi bi-gear-fill"></i>
                    </button>
                </div>
            </div>

            <div class="panel">
                <h3>Channels</h3>
                <div class="channels" id="channels"></div>
                <div class="row" style="margin-top:8px">
                    <button id="btnOpenCreateChannel" class="button grow" title="Create Channel">
                        <i class="bi bi-plus-lg"></i> Create channel
                    </button>
                </div>
            </div>
        </aside>
        <main id="main">
            <div class="topbar">
                <div class="left">
                    <button class="iconbtn toggle-sidebar" id="btnToggleSidebar" title="Menu"><i
                            class="bi bi-list"></i></button>
                    <div class="name" id="channelName">Select a channel</div>
                </div>
                <div class="members" id="memberInfo">—</div>
                <div id="voiceCallParticipantsIcons" class="voice-participants-icons"></div>
                <button id="btnStartCall" class="button small"
                    style="display:none; margin-left:8px; padding: 6px 12px; font-size: 13px;">Start Call</button>
            </div>

            <div id="callInterface" class="call-interface" style="display:none">
                <div class="call-content">
                    <div class="call-header">
                        <div class="call-status">Voice Connected</div>
                        <div class="call-controls">
                            <button id="btnMute" class="iconbtn" title="Mute">
                                <i class="bi bi-mic"></i>
                            </button>
                            <button id="btnDeafen" class="iconbtn" title="Deafen">
                                <i class="bi bi-volume-up-fill"></i>
                            </button>
                            <button id="btnScreenShare" class="iconbtn" title="Share Screen">
                                <i class="bi bi-display"></i>
                            </button>
                            <button id="btnSharePlay" class="iconbtn" title="Share Play">
                                <i class="bi bi-collection-play"></i>
                            </button>
                            <button id="btnLeaveCall" class="iconbtn danger" title="Leave Call">
                                <i class="bi bi-telephone-x-fill"></i>
                            </button>
                        </div>
                    </div>
                    <div id="callParticipants" class="call-participants"></div>
                    <div id="videoGrid" class="video-grid"></div>
                    <div id="shareplayContainer" class="shareplay-container" style="display:none">
                        <div id="nowPlaying">
                            <p id="nowPlayingTitle">Nothing is playing.</p>
                            <div class="shareplay-seek-row">
                                <span id="nowPlayingCurrentTime" class="shareplay-timestamp">0:00</span>
                                <div id="nowPlayingSeek"></div>
                                <span id="nowPlayingTotalTime" class="shareplay-timestamp">0:00</span>
                            </div>
                            <div id="shareplayControls" class="shareplay-controls">
                                <button id="btnSharePlayPrevious" class="iconbtn">
                                    <i class="bi bi-skip-backward"></i>
                                </button>
                                <button id="btnSharePlayPause" class="iconbtn">
                                    <i class="bi bi-pause"></i>
                                </button>
                                <button id="btnSharePlayNext" class="iconbtn">
                                    <i class="bi bi-skip-forward"></i>
                                </button>
                                <button id="btnSharePlayRepeat" class="iconbtn">
                                    <i class="bi bi-repeat"></i>
                                </button>
                                <div class="shareplay-volume-row">
                                    <i class="bi bi-volume-up-fill"></i>
                                    <input type="range" id="shareplayVolume" min="0" max="100" value="40">
                                </div>
                            </div>
                        </div>
                        <div id="shareplayQueue" class="shareplay-queue">
                            <div id="shareplayQueueItems" class="shareplay-queue-items"></div>
                            <div id="shareplayQueueAdd" class="shareplay-queue-add">
                                <input type="text" id="shareplayQueueAddInput" placeholder="Enter a URL or file path">
                                <button id="shareplayQueueAddButton" class="iconbtn">
                                    <i class="bi bi-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fullscreen Video Overlay -->
            <div id="videoFullscreen" class="video-fullscreen hidden"></div>

            <!-- Singleton Volume Slider -->
            <div id="voiceVolumeControl" class="volume-slider-container">
                <input type="range" class="volume-slider" min="0" max="2" step="0.1" value="1.0" />
                <span class="volume-label">100%</span>
            </div>

            <div class="messages" id="messages">
                <!-- Load older -->
            </div>

            <div class="typing" id="typingIndicator" style="display:none">Someone is typing…</div>

            <div class="inputbar">
                <label class="iconbtn" title="Attach file" style="cursor:pointer">
                    <i class="bi bi-paperclip"></i>
                    <input id="attachFile" type="file" style="display:none" />
                </label>
                <textarea id="msgInput" disabled></textarea>
                <button id="btnSend" class="iconbtn" title="Send" disabled><i class="bi bi-send-fill"></i></button>
            </div>
        </main>
    </div>
    <div id="settingsModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-card glass">
            <div class="modal-header">
                <div class="brand small"><i class="bi bi-gear-fill"></i> Settings</div>
                <button id="btnCloseSettings" class="iconbtn" title="Close"><i class="bi bi-x-lg"></i></button>
            </div>

            <div class="modal-content">
                <section class="panel">
                    <h3>Profile</h3>
                    <div class="row" style="align-items:center">
                        <div class="avatar" id="settingsAvatarPreview"></div>
                        <label class="button alt" for="setAvatarFile"
                            style="cursor:pointer; text-align:center; width:200px">
                            Change Profile Picture
                        </label>
                        <input id="setAvatarFile" type="file" accept="image/*" style="display:none" />
                    </div>
                    <div class="row">
                        <input id="profileUsername" class="input grow" placeholder="Screen name" />
                    </div>
                    <div class="row" style="gap:8px; flex-wrap:wrap">
                        <input id="curPwd" class="input" type="password" placeholder="Current password"
                            style="flex:1; min-width:220px" />
                        <input id="newPwd" class="input" type="password" placeholder="New password"
                            style="flex:1; min-width:220px" />
                        <button id="btnChangePassword" class="button" style="width:200px">Change Password</button>
                    </div>
                    <div class="row">
                        <button id="btnSaveProfile" class="button">Save Profile Info</button>
                    </div>
                </section>
                <section class="panel">
                    <h3>Audio Settings</h3>
                    <p class="error">NOTE: Noise suppression works well, the other two aren't fully tested. If you run
                        into issues with them, tell Will.</p>
                    <div class="row" style="flex-direction: column; gap: 8px;">
                        <label class="row" style="gap:10px; align-items:center; cursor:pointer">
                            <input type="checkbox" id="prefNoiseSuppression" checked />
                            <span>Noise Suppression</span>
                        </label>
                        <label class="row" style="gap:10px; align-items:center; cursor:pointer">
                            <input type="checkbox" id="prefEchoCancellation" />
                            <span>Echo Cancellation</span>
                        </label>
                        <label class="row" style="gap:10px; align-items:center; cursor:pointer">
                            <input type="checkbox" id="prefAutoGainControl" />
                            <span>Auto Gain Control</span>
                        </label>
                    </div>
                </section>
                <section class="panel">
                    <h3>Theme</h3>
                    <div class="row" style="gap:16px; align-items:center; flex-wrap: wrap">
                        <label><input type="radio" name="themeSel" value="dark" /> Dark</label>
                        <label><input type="radio" name="themeSel" value="light" /> Light</label>
                        <label><input type="radio" name="themeSel" value="mysterious" /> Mysterious</label>
                        <label><input type="radio" name="themeSel" value="pink" /> Pink</label>
                        <label><input type="radio" name="themeSel" value="question" /> Question</label>
                        <label><input type="radio" name="themeSel" value="billzinga" /> Billzinga</label>
                        <label><input type="radio" name="themeSel" value="wegmans" /> Wegmans</label>
                        <label><input type="radio" name="themeSel" value="clouds" /> Clouds</label>
                        <label><input type="radio" name="themeSel" value="rain" /> Rain</label>
                    </div>
                </section>
                <section class="panel">
                    <h3>Server</h3>
                    <p class="error">NOTE: If Will didn't tell you to change this, you probably don't want to change it.
                    </p>
                    <div class="row">
                        <input id="settingsBaseUrl" class="input grow" placeholder="Base URL (http://host:port)" />
                        <button id="btnSaveBaseUrl" class="button" style="width:140px">Connect</button>
                    </div>
                </section>
                <section class="panel">
                    <h3>Account</h3>
                    <div class="row">
                        <button id="btnLogoutSettings" class="button danger grow">Logout</button>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <!-- Create Channel Modal -->
    <div id="createChannelModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-card glass">
            <div class="modal-header">
                <div class="brand small"><i class="bi bi-hash"></i> Create Channel</div>
                <button id="btnCloseCreateChannel" class="iconbtn" title="Close"><i class="bi bi-x-lg"></i></button>
            </div>
            <div class="modal-content">
                <section class="panel">
                    <h3>Details</h3>
                    <div class="row">
                        <input id="chName" class="input grow" placeholder="Channel name" />
                    </div>
                    <div class="row" style="align-items:center; gap:12px">
                        <label class="row" style="gap:6px; align-items:center">
                            <input type="checkbox" id="chIsVoice" /> Voice channel
                        </label>
                        <label class="row" style="gap:6px; align-items:center">
                            <input type="checkbox" id="chIsPrivate" /> Private channel
                        </label>
                    </div>
                </section>
                <section class="panel" id="channelMembersSection" style="display:none">
                    <h3>Private Members</h3>
                    <div class="row">
                        <select id="channelMembersSelect" class="select grow" multiple size="8"></select>
                    </div>
                    <div class="hint">Hold Shift or Ctrl/Command to select multiple users</div>
                </section>
                <section class="panel">
                    <div class="row">
                        <button id="btnCreateChannelSubmit" class="button grow">Create</button>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <!-- Edit Channel Modal -->
    <div id="editChannelModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-card glass">
            <div class="modal-header">
                <div class="brand small"><i class="bi bi-gear-fill"></i> Edit Channel</div>
                <button id="btnCloseEditChannel" class="iconbtn" title="Close"><i class="bi bi-x-lg"></i></button>
            </div>
            <div class="modal-content">
                <section class="panel">
                    <h3>Details</h3>
                    <div class="row">
                        <input id="editChName" class="input grow" placeholder="Channel name" />
                    </div>
                    <div class="row" style="align-items:center; gap:12px">
                        <label class="row" style="gap:6px; align-items:center">
                            <input type="checkbox" id="editChIsVoice" /> Voice channel
                        </label>
                        <label class="row" style="gap:6px; align-items:center">
                            <input type="checkbox" id="editChIsPrivate" /> Private channel
                        </label>
                    </div>
                </section>
                <section class="panel">
                    <h3>Manage Members</h3>
                    <div class="row" style="gap:8px">
                        <div style="flex:1">
                            <h4>Current Members</h4>
                            <select id="editChannelMembersCurrent" class="select grow" multiple size="8"></select>
                            <button id="btnRemoveMembers" class="button alt small" style="margin-top:4px">Remove
                                Selected</button>
                        </div>
                        <div style="flex:1">
                            <h4>Add Members</h4>
                            <select id="editChannelMembersAdd" class="select grow" multiple size="8"></select>
                            <button id="btnAddMembers" class="button alt small" style="margin-top:4px">Add
                                Selected</button>
                        </div>
                    </div>
                    <div class="hint" style="margin-top:8px">Hold Shift or Ctrl/Command to select multiple users</div>
                </section>
                <section class="panel">
                    <div class="row" style="gap:12px">
                        <button id="btnEditChannelSave" class="button grow">Save Changes</button>
                        <button id="btnEditChannelDelete" class="button danger" style="width:140px">Delete
                            Channel</button>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <!-- Invites Modal -->
    <div id="inviteModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-card glass">
            <div class="modal-header">
                <div class="brand small"><i class="bi bi-people-fill"></i> Invites</div>
                <button id="btnCloseInvites" class="iconbtn" title="Close"><i class="bi bi-x-lg"></i></button>
            </div>
            <div class="modal-content">
                <section class="panel">
                    <h3>Create Invite</h3>
                    <div class="row">
                        <button id="btnCreateInvite" class="button">Create New Invite Code</button>
                    </div>
                </section>
                <section class="panel">
                    <h3>My Invites</h3>
                    <div class="table-container" style="overflow-x:auto">
                        <table style="width:100%; border-collapse: collapse; margin-top: 8px;">
                            <thead>
                                <tr style="border-bottom: 1px solid var(--border); text-align: left;">
                                    <th style="padding: 8px;">Code</th>
                                    <th style="padding: 8px;">Used By</th>
                                    <th style="padding: 8px;">Created At</th>
                                </tr>
                            </thead>
                            <tbody id="inviteList">
                                <!-- Invites populated here -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <script type="module" src="main.js"></script>
</body>

</html>