<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>StuffChat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <!-- Bootstrap Icons only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
    <link href="style.css" rel="stylesheet" />
</head>

<body>
    <div id="authView" class="glass auth-card">
        <!-- Step 1: Server configuration -->
        <div id="serverStep">
            <div class="brand"><i class="bi bi-chat-dots"></i> StuffChat</div>
            <div class="hint">Enter your server address to begin</div>
            <div class="row">
                <input id="cfgBaseUrl" class="input grow" placeholder="Base URL (e.g. http://localhost:8080)" />
                <button id="btnCheckServer" class="button" style="width:140px">Connect</button>
            </div>
            <div id="serverError" class="error"></div>
        </div>

        <!-- Step 2: Authentication -->
        <div id="authStep" style="display:none">
            <div class="brand"><i class="bi bi-chat-dots"></i> StuffChat</div>
            <div class="hint" id="serverIdentifier"></div>
            
            <div class="panel">
                <h3>Login</h3>
                <div class="row">
                    <input id="loginUser" class="input grow" placeholder="Username or email" autocomplete="username" />
                </div>
                <div class="row">
                    <input id="loginPass" class="input grow" type="password" placeholder="Password" 
                        autocomplete="current-password" />
                </div>
                <div class="row">
                    <button id="btnLogin" class="button grow">Login</button>
                </div>
                <div id="loginErr" class="error"></div>
            </div>

            <div class="panel" style="margin-top:8px">
                <h3>Register</h3>
                <div class="row"><input id="regUser" class="input grow" placeholder="Username" autocomplete="username" /></div>
                <div class="row"><input id="regEmail" class="input grow" placeholder="Email" autocomplete="email" /></div>
                <div class="row"><input id="regPass" class="input grow" type="password" placeholder="Password (min 8 chars)"
                        autocomplete="new-password" /></div>
                <div class="row"><button id="btnRegister" class="button grow">Create account</button></div>
                <div id="regErr" class="error"></div>
            </div>

            <div class="row" style="margin-top:12px">
                <button class="button alt grow" onclick="showServerStep()">← Back to Server Settings</button>
            </div>
        </div>
    </div>

    <div id="appView" class="app" style="display:none">
        <aside id="sidebar" class="glass">
            <div class="profile">
                <div class="avatar" id="meAvatar"></div>
                <div style="min-width:0">
                    <div style="display:flex; align-items:center; gap:6px; flex-wrap:wrap">
                        <div id="meName" style="font-weight:600">—</div>
                        <span id="mePresence" class="presence-dot presence-offline" title="offline"></span>
                    </div>
                    <div id="meEmail" class="hint">—</div>
                </div>
            </div>

            <div class="panel">
                <h3>Channels</h3>
                <div class="channels" id="channels"></div>
                <div class="row" style="margin-top:8px">
                    <input id="newChannelName" class="input grow" placeholder="New channel name" />
                    <button id="btnCreateChannel" class="iconbtn" title="Create">
                        <i class="bi bi-plus-lg"></i>
                    </button>
                </div>
            </div>

            <div class="panel settings">
                <h3>Settings</h3>
                <input id="baseUrl" class="input" placeholder="Base URL (http://host:port)" />
                <div class="row">
                    <select id="presenceSelect" class="select grow" title="Status">
                        <option value="online">Online</option>
                        <option value="away">Away</option>
                        <option value="dnd">Do Not Disturb</option>
                        <option value="invisible">Invisible</option>
                        <option value="offline">Offline</option>
                    </select>
                    <button id="btnPresenceShow" class="iconbtn">
                        <span id="mePresenceSettings" class="presence-dot"></span>
                    </button>
                </div>
                <div class="row">
                    <label class="button alt grow" style="cursor:pointer; text-align:center">
                        Change avatar
                        <input id="avatarFile" type="file" accept="image/*" style="display:none" />
                    </label>
                </div>
                <div class="row">
                    <button id="btnLogout" class="button danger">
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </aside>

        <main id="main">
            <div class="topbar">
                <div class="left">
                    <button class="iconbtn toggle-sidebar" id="btnToggleSidebar" title="Menu"><i
                            class="bi bi-list"></i></button>
                    <div class="name" id="channelName">Select a channel</div>
                </div>
                <div class="members" id="memberInfo">—</div>
            </div>

            <div class="messages" id="messages">
                <!-- Load older -->
            </div>

            <div class="typing" id="typingIndicator" style="display:none">Someone is typing…</div>

            <div class="inputbar">
                <label class="iconbtn" title="Attach file" style="cursor:pointer">
                    <i class="bi bi-paperclip"></i>
                    <input id="attachFile" type="file" style="display:none" />
                </label>
                <textarea id="msgInput" placeholder="Write a message…" disabled></textarea>
                <button id="btnSend" class="iconbtn" title="Send" disabled><i class="bi bi-send-fill"></i></button>
            </div>
        </main>
    </div>

    <script src="frontend.js"></script>
</body>

</html>